<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/leaflet/1.0.3/leaflet.css" />
  <script src="https://cdn.jsdelivr.net/leaflet/1.0.3/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/leaflet-routing-machine/3.2.12/leaflet-routing-machine.css" />
</head>
<body>

<div id="map" style="height: 500px"></div>

<script>
  // Create the Leaflet map and set its initial view
  var map = L.map('map').setView([51.505, -0.09], 13);

  // Add the tile layer to the map (in this case, OpenStreetMap)
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
    maxZoom: 18
  }).addTo(map);

  // Define an array to hold the selected locations
  var locations = [];

  // Create a button to add locations to the array
  var addButton = L.control({position: 'topright'});

  addButton.onAdd = function (map) {
      var div = L.DomUtil.create('div', 'add-button');
      div.innerHTML = '<button onclick="addLocation()">Add location</button>';
      return div;
  };

  addButton.addTo(map);

  // Function to add a location to the array
  function addLocation() {
    // Use Leaflet's mouse click event to get the latitude and longitude of the clicked point
    map.on('click', function(e) {
      var location = [e.latlng.lat, e.latlng.lng];
      locations.push(location);
      // Add a marker at the selected location
      L.marker(location).addTo(map);
    });
  }

  // Create a button to find the shortest path
  var findButton = L.control({position: 'topright'});

  findButton.onAdd = function (map) {
      var div = L.DomUtil.create('div', 'find-button');
      div.innerHTML = '<button onclick="findShortestPath()">Find shortest path</button>';
      return div;
  };

  findButton.addTo(map);
  // Create a button to add the user's current location to the array
  var currentLocationButton = L.control({position: 'topright'});

  currentLocationButton.onAdd = function (map) {
      var div = L.DomUtil.create('div', 'current-location-button');
      div.innerHTML = '<button onclick="getCurrentLocation()">Use current location</button>';
      return div;
  };

  currentLocationButton.addTo(map);

  // Function to get the user's current location
  function getCurrentLocation() {
    // Check if the browser supports geolocation
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var location = [position.coords.latitude, position.coords.longitude];
        locations.push(location);
        // Add a marker at the user's current location
        L.marker(location).addTo(map);
      });
    } else {
      alert("Geolocation is not supported by this browser.");
    }
  }

  // Function to find the shortest path using the selected locations
  function findShortestPath() {
  // Use the Leaflet Routing Machine plugin to find the shortest path
  var router = L.Routing.osrmv1();
  var waypoints = [];

  // Get the user's current location and add it to the waypoints array
  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var currentLocation = L.latLng(position.coords.latitude, position.coords.longitude);
      waypoints.push(currentLocation);

      // Add the locations from the locations array to the waypoints array
      for (var i = 0; i < locations.length; i++) {
        waypoints.push(L.latLng(locations[i][0], locations[i][1]));
      }

      // Find the shortest path
      router.route(waypoints, function(err, routes) {
        if (err) {
          console.log(err);
        } else {
          // Display the shortest path on the map
          L.Routing.line(routes[0]).addTo(map);
        }
      });
    });
  } else {
    alert("Geolocation is not supported by this browser.");
  }
}

</script>

</body>
</html>
